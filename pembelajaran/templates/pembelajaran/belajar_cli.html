{% extends 'pembelajaran/base.html' %}
{% load static %}
{% block title %}Belajar Linux — LinuxEdu{% endblock %}

{% block head_extra %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
  :root{
    --accent:#ff8c42;
    --accent-light:#ffd5b6;
    --muted:#6b6b6b;
    --card-bg:#ffffff;
    --shadow:0 6px 18px rgba(255, 0, 0, 0.04);
  }

  body{ background:linear-gradient(180deg,#fff,#fff9f5); }

  .page-wrap{
    padding:2rem 1rem;
    max-width:1100px;
    margin:0 auto;
  }

  .hero {
    margin-bottom:2rem;
    text-align:left;
  }
  .hero h1 { 
    font-size:1.9rem; 
    color:var(--accent); 
    font-weight:800; 
    letter-spacing:.2px; 
  }
  .hero p { color:var(--muted); margin-top:.4rem; }

  .grid { 
    display:grid; 
    grid-template-columns: repeat(auto-fit,minmax(310px,1fr)); 
    gap:1.2rem; 
  }

  .chap-card {
    position:relative;
    border-radius:14px;
    background:var(--card-bg);
    box-shadow:var(--shadow);
    overflow:hidden;
    transition:transform .25s ease, box-shadow .25s ease;
  }
  .chap-card:hover{ transform:translateY(-5px); box-shadow:0 10px 28px rgba(15,15,15,0.08); }

  .chap-head {
    padding:1.2rem 1.4rem;
    display:flex;
    align-items:center;
    gap:1rem;
    border-bottom:1px solid rgba(0,0,0,0.03);
  }
  .chap-index {
    width:50px;height:50px;
    border-radius:10px;
    background:linear-gradient(180deg,#fff1e6,#fff7f2);
    color:var(--accent);
    font-weight:700;
    font-size:1.1rem;
    display:flex;align-items:center;justify-content:center;
    box-shadow: inset 0 -4px 8px rgba(255,140,66,0.06);
  }

  .chap-body { padding:1.2rem 1.4rem; }

  .muted-small { font-size:.93rem; color:var(--muted); }

  .btn-clean {
    background:transparent;
    border:1px solid rgba(0,0,0,0.06);
    color:var(--accent);
    padding:.5rem .9rem;
    border-radius:10px;
    font-weight:700;
    transition:all .25s ease;
  }
  .btn-clean:hover {
    background:var(--accent);
    color:#fff;
    transform:translateY(-3px);
    box-shadow:0 10px 20px rgba(255,140,66,0.12);
  }
  
  .progress-wrap { 
    margin-top:.9rem;
    display:flex; gap:.8rem; align-items:center;
  }
  .progress {
    height:10px; flex:1;
    background:#f2f2f2;
    border-radius:999px;
    overflow:hidden;
  }
  .progress .bar {
    height:100%; width:0%;
    background:linear-gradient(90deg,var(--accent),#ffb289);
    transition:width .4s cubic-bezier(.2,.9,.2,1);
  }

  /* locked look */
  .locked {
    opacity:.7;
    filter:grayscale(.4);
    cursor:not-allowed;
  }

  /* summary */
  .summary {
    position:sticky; top:20px;
    background:#fff;
    border-radius:12px;
    padding:1.3rem;
    box-shadow:var(--shadow);
  }
  .summary h5 {
    color:var(--accent);
    font-weight:800;
    font-size:1.15rem;
    margin-bottom:.6rem;
  }
  .summary .total { font-weight:800; color:var(--accent); font-size:1.4rem; }

  @media(max-width:768px){
    .grid{ grid-template-columns:1fr; }
  }
</style>
{% endblock %}

{% block content %}
<div class="page-wrap">
  <div class="hero">
    <h1>Belajar Command Line — Modul & Progres</h1>
    <p class="muted-small">Progress tersinkron otomatis dengan setiap chapter. Baca hingga akhir materi untuk mencapai 100%.</p>
  </div>

  <div class="row gy-4 gx-4">
    <div class="col-lg-7">
      <div class="grid">

        <!-- Chapter 1 -->
        <div class="chap-card">
          <div class="chap-head">
            <div class="chap-index">1</div>
            <div style="flex:1">
              <div class="d-flex justify-content-between align-items-center flex-wrap">
                <div>
                  <div style="font-weight:800;">Chapter 1 — Command Line</div>
                  <div class="muted-small">Command Line Dasar Pada Ubuntu</div>
                </div>
                <a id="open-ch1" href="{% url 'pembelajaran:linux_chapter1' %}" class="btn-clean">Buka</a>
              </div>
              <div class="progress-wrap">
                <div class="muted-small">Progress</div>
                <div class="progress"><div id="ch1-bar" class="bar"></div></div>
                <div id="ch1-val" class="muted-small text-end" style="min-width:58px;">0%</div>
              </div>
            </div>
          </div>
          <div class="chap-body">
            <div class="muted-small">Status: <span id="ch1-status">Belum selesai</span></div>
          </div>
        </div>

        <!-- Chapter 2 -->
        <div class="chap-card locked">
          <div class="chap-head">
            <div class="chap-index">2</div>
            <div style="flex:1">
              <div class="d-flex justify-content-between align-items-center flex-wrap">
                <div>
                  <div style="font-weight:800;">Chapter 2 — Manajemen Sistem</div>
                  <div class="muted-small">User, permission, systemd, dan administrasi dasar.</div>
                </div>
                <button class="btn-clean" disabled>Terkunci</button>
              </div>
              <div class="progress-wrap">
                <div class="muted-small">Progress</div>
                <div class="progress"><div id="ch2-bar" class="bar"></div></div>
                <div id="ch2-val" class="muted-small text-end">0%</div>
              </div>
            </div>
          </div>
          <div class="chap-body">
            <div class="muted-small">Terkunci — selesaikan Chapter 1 untuk membuka.</div>
          </div>
        </div>

        <!-- Chapter 3  -->
        <div class="chap-card locked">
          <div class="chap-head">
            <div class="chap-index">3</div>
            <div style="flex:1">
              <div class="d-flex justify-content-between align-items-center flex-wrap">
                <div>
                  <div style="font-weight:800;">Chapter 3 — Jaringan & Keamanan</div>
                  <div class="muted-small">Dasar jaringan, SSH, firewall, dan keamanan sistem.</div>
                </div>
                <button class="btn-clean" disabled>Terkunci</button>
              </div>
              <div class="progress-wrap">
                <div class="muted-small">Progress</div>
                <div class="progress"><div id="ch3-bar" class="bar"></div></div>
                <div id="ch3-val" class="muted-small text-end">0%</div>
              </div>
            </div>
          </div>
          <div class="chap-body">
            <div class="muted-small">Terkunci — selesaikan Chapter 1 & 2 untuk membuka.</div>
          </div>
        </div>

      </div>
    </div>

    <!-- Side summary -->
    <div class="col-lg-5">
      <div class="summary">
        <h5>Ringkasan Progress</h5>
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <div class="muted-small">Total progress</div>
            <div class="total" id="total-percent">0%</div>
          </div>
          <button id="reset-progress" class="btn-clean">Reset</button>
        </div>

        <div class="mt-3 muted-small">
          <ul class="mb-0 ps-3">
            <li>Baca seluruh materi untuk menaikkan progress.</li>
            <li>Progress disimpan di browser (localStorage).</li>
            <li>Progress Chapter 1 otomatis sinkron ke sini.</li>
          </ul>
        </div>
      </div>

      <div class="mt-3 p-3" style="background:#fff;border-radius:12px;box-shadow:var(--shadow);">
        <div style="font-weight:700;color:var(--accent);">Tips</div>
        <div class="muted-small mt-1">
          Klik <b>Buka</b> untuk membaca Chapter 1. Setelah kamu menyelesaikannya, progress akan berubah otomatis di sini.
        </div>
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', ()=> {
  const ch1Bar=document.querySelector('#ch1-bar');
  const ch1Val=document.querySelector('#ch1-val');
  const ch1Status=document.querySelector('#ch1-status');
  const total=document.querySelector('#total-percent');

  // ambil progress dari localStorage
  const chapterCompleted = localStorage.getItem('chapter1_completed') === 'true';
  let savedSections = [];
  try { savedSections = JSON.parse(localStorage.getItem('chapter1_done') || '[]'); } catch(e) {}

  // jumlah total section di Chapter 1
  const totalSections = 8;
  let percent = 0;

  if (chapterCompleted) {
    percent = 100;
  } else if (savedSections.length > 0) {
    percent = Math.min(100, Math.round((savedSections.length / totalSections) * 100));
  }

  ch1Bar.style.width = percent + '%';
  ch1Val.textContent = percent + '%';
  ch1Status.textContent = percent >= 100 ? 'Selesai' : 'Belum selesai';
  total.textContent = percent + '%';

 if (percent >= 100) {
  const ch2Card = document.querySelector('.chap-card.locked:nth-of-type(2)');
  if (ch2Card) {
    ch2Card.classList.remove('locked');
    const btn = ch2Card.querySelector('button.btn-clean');
    if (btn) {
      btn.removeAttribute('disabled');
      btn.textContent = 'Buka';
      btn.addEventListener('click', ()=>{
        window.location.href = "{% url 'pembelajaran:linux_chapter2' %}";
      });
    }
  }
}

  document.querySelector('#reset-progress').addEventListener('click', ()=>{
    if(confirm('Yakin ingin reset semua progress?')){
      localStorage.clear();
      location.reload();
    }
  });
});
</script>
{% endblock %}
